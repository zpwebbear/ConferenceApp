@page "/participants/{ParticipantID:int}"
@using ConferenceApp.Models
@using ConferenceApp.Services
@using ConferenceApp.Pages.Participant.Services
@using ConferenceApp.Shared.Forms
@inject IParticipantService ParticipantService
@inject IGenderService GenderService
@inject IParticipantRoleService ParticipantRoleService
@inject ICountryService CountryService
@inject NavigationManager NavigationManager
@inject ParticipantRazorService ParticipantRazorService
@implements IDisposable

<div class="container">
    @if (participant != null)
    {
    <EditForm Model="@participant" OnValidSubmit="UpdateParticipant">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <fieldset disabled="@(editMode == false)">
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="first-name">First Name</label>
                        <InputText type="text" class="form-control" id="first-name" @bind-Value="@participant.FirstName" />
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="last-name">Last Name</label>
                        <InputText type="text" class="form-control" id="last-name" @bind-Value="@participant.LastName" />
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <InputText type="email" class="form-control" id="email" @bind-Value="@participant.Email" />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="company">Company</label>
                        <InputText type="text" class="form-control" id="company" @bind-Value="@participant.CompanyName" />
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="position">Position</label>
                        <InputText type="text" class="form-control" id="position" @bind-Value="@participant.PositionInCompany" />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <CustomInputSelect class="custom-select" @bind-Value="@participant.Gender.ID">
                            @foreach (var gender in genders)
                                {
                                <option selected="@(gender.ID == participant.Gender.ID)" value="@gender.ID">@gender.Value</option>
                                }
                        </CustomInputSelect>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="position">Role</label>
                        <CustomInputSelect class="custom-select" @bind-Value="@participant.Role.ID">
                            @foreach (var role in roles)
                                {
                                <option selected="@(role.ID == participant.Role.ID)" value="@role.ID">@role.RoleName</option>
                                }
                        </CustomInputSelect>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select class="custom-select">
                            @foreach (var gender in genders)
                                {
                                <option selected="@(gender.ID == participant.Gender.ID)" value="@gender.ID">@gender.Value</option>
                                }
                        </select>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="position">Role</label>
                        <select class="custom-select" >
                            @foreach (var role in roles)
                                {
                                <option selected="@(role.ID == participant.Role.ID)" value="@role.ID">@role.RoleName</option>
                                }
                        </select>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="country">Country</label>
                        <CustomInputSelect class="custom-select" @bind-Value="@participant.Country.ID">
                            @foreach (var country in countries)
                                {
                                <option selected="@(country.ID == participant.Country.ID)" value="@country.ID">@country.Name</option>
                                }
                            /**/
                        </CustomInputSelect>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="birthdate">Birth Date</label>
                        <InputDate class="form-control" id="birthdate" @bind-Value="@participant.BirthDate" />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="date-of-arrival">Date of Arrival</label>
                        <InputDate class="form-control" id="date-of-arrival" @bind-Value="@participant.DateOfArrival" />
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="date-of-departure">Date of Departure</label>
                        <InputDate class="form-control" id="date-of-departure" @bind-Value="@participant.DateOfDeparture" />
                    </div>
                </div>
            </div>
        </fieldset>
        <div class="row">
            <div class="form-group">
                @if (editMode)
                {
                    <button type="submit" class="btn btn-primary ml-1">Submit</button>

                }
                @if (!editMode)
                {
                    <button @onclick="SetEditMode" @onclick:preventDefault class="btn btn-success ml-1">Edit</button>
                }
                <button class="btn btn-danger ml-1">Delete</button>
            </div>
        </div>
    </EditForm>
    }
</div>



@code {
    [Parameter] public int ParticipantID { get; set; }
    private Participant participant;
    private List<Gender> genders;
    private List<ParticipantRole> roles;
    private List<Country> countries;

    private bool editMode = false;

    protected override async Task OnInitializedAsync()
    {
        participant = await ParticipantService.Get(ParticipantID);
        genders = await GenderService.Get();
        roles = await ParticipantRoleService.Get();
        countries = await CountryService.Get();

    }

    private void SetEditMode()
    {
        editMode = true;
    }

    private void UpdateParticipant()
    {
        ParticipantService.Update(participant);
        editMode = false;
    }

    private string DisabledClass()
    {
        return editMode ? "" : "disabled";
    }

    public void Dispose()
    {
    }
}